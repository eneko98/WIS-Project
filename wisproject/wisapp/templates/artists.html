{% extends 'base.html' %}
{% load static %}

{% block content %}

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Let's get shit done</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>
<style>
    .album-container {
        display: flex;
        gap: 20px; /* Increased gap between album covers */
        align-items: flex-start; /* Align items at the start of the flex container */
        overflow-x: auto; /* Allow horizontal scrolling if necessary */
        margin-bottom: 20px; /* Add some margin at the bottom */
    }
    .album-item {
        width: 150px; /* Set a fixed width for each album cover */
        text-align: center; /* Center align the album cover and text */
        overflow: hidden; /* Hide any overflow content */
    }
    .album-item img {
        max-width: 100%; /* Ensure the image fits within the container */
        height: auto;
        margin-bottom: 5px; /* Add some space below the image */
    }
    .album-info {
        font-size: 12px; /* Adjust font size for album info */
        line-height: 1.2; /* Set line height for better readability */
        max-height: 40px; /* Set a fixed height for album info */
        overflow: hidden; /* Hide any overflow content */
    }
</style>


<body>
    <br>
    <br>
    <br>
    <div id="artist1">
        <h2 class="artistname"> </h2>
        <div id="image1"> </div>
        <p class="genre"> Genre: </p>
        <p class="followers"> Followers:  </p>
        <div class="albuminfo album-container"></div>
        
       
        <br>
        <br>
    </div>
    <div id="artist2"> 
        <h2 class="artistname"> </h2>
        <div id="image2"> </div>
        <p class="genre">Genre: </p>
        <p class="followers">Followers: </p>
        <div class="albuminfo album-container"></div>
       
        <br>
        <br>
    </div>
    <div id="artist3">
        <h2 class="artistname"> </h2>
        <div id="image3"> </div>
        <p class="genre"> Genres: </p>
        <p class="followers">Followers:  </p>
        <div class="albuminfo album-container"></div>
       
        <br>
        <br>
     </div>
    <div id="artist4"> 
        <h2 class="artistname"> </h2>
        <div id="image4"> </div>
        <p class="genre">Genres: </p>
        <p class="followers"> Followers: </p>
        <div class="albuminfo album-container"></div>
        
        <br>
        <br>
    </div>
    <script>
        //Post
        // curl -X POST "https://accounts.spotify.com/api/token" -H "Content-Type: application/x-www-form-urlencoded" -d "grant_type=client_credentials&client_id=52c45b6398544dce8ff8d3b9eb41d71f&client_secret=82c3bc810f8145d4b9b3c892607d8526"
        // Invoke-RestMethod -Uri "https://accounts.spotify.com/api/token" -Method POST -Headers @{"Content-Type"="application/x-www-form-urlencoded"} -Body "grant_type=client_credentials&client_id=52c45b6398544dce8ff8d3b9eb41d71f&client_secret=82c3bc810f8145d4b9b3c892607d8526"
        //https://open.spotify.com/artist/4CiDIYMPPxX4ZOJ2R1ZL9e?si=YVlwIKdAQ5iSM6Y_-tpomw
        artist_urls = ["4CiDIYMPPxX4ZOJ2R1ZL9e", "17qPb5DXDDbJixc4cmwJiF", "5l1EOSszNDO4mCXhXIxmTL", "1RyvyyTE3xzB2ZywiAwp0i"]
        const url = "https://accounts.spotify.com/api/token";
        const headers = {
            "Content-Type": "application/x-www-form-urlencoded"
        };
        const body = "grant_type=client_credentials&client_id=52c45b6398544dce8ff8d3b9eb41d71f&client_secret=82c3bc810f8145d4b9b3c892607d8526";
        let auth_code = ""
        
        
        fetch(url, {
            method: 'POST',
            headers: headers,
            body: body
        })
        .then(response => response.json())
        .then(data => {
            auth_code = data['access_token'];
            Promise.all(artist_urls.map(url => get_artist_info(url, auth_code))).then(artistDataArray => {
                artistDataArray.forEach((data, index) => {
                    if (data) { // Check if data is not undefined
                        const ind = index + 1;
                        const img_id = "image" + ind;
                        const artist_id = "artist" + ind;
                        const artist_element = document.getElementById(artist_id);
                        artist_element.querySelector('.artistname').innerText = data['name'];
                        artist_element.querySelector('.genre').innerText += " " + data['genres'].join(', ');
                        artist_element.querySelector('.followers').innerText += " " +  data['followers']['total'];
                        document.getElementById(img_id).innerHTML = "<img src=" + data['images'][2]['url'] + ">";

                        get_album_info(artist_urls[index], auth_code, artist_element.querySelector('.albuminfo'));
                    }
                });
            });
        })
        .catch(error => console.error('Error:', error));


        function get_artist_info(url, auth_code) {
            const total_url = "https://api.spotify.com/v1/artists/" + url;
            return fetch(total_url, {
                method: "GET",
                headers: {
                    "Authorization": "Bearer " + auth_code
                }
            }).then(response => {
                if (!response.ok) {
                    throw new Error("Network response was not ok");
                }
                return response.json();
            }).catch(error => {
                console.error("Fetch error:", error);
                return null; // Return null if there's an error
            });
        }

        function get_album_info(artist_url, auth_code, element) {
            const albums_url = `https://api.spotify.com/v1/artists/${artist_url}/albums?limit=5`;
            fetch(albums_url, {
                method: "GET",
                headers: {
                    "Authorization": "Bearer " + auth_code
                }
            }).then(response => {
                if (!response.ok) {
                    throw new Error("Network response was not ok");
                }
                return response.json();
            }).then(data => {
                // Extract relevant album information and display it in the provided element
                const albums = data.items.map(item => {
                    return {
                        name: item.name,
                        release_date: item.release_date,
                        image: item.images[0].url // Assuming the first image represents the album cover
                    };
                });

                // Construct HTML for displaying album information
                const html = albums.map(album => {
                    return `<div class="album-item"><img src="${album.image}" alt="${album.name}"><p>${album.name}</p><p> ${album.release_date}</p></div>`;
                }).join('');

                // Set the HTML content in the provided element
                element.innerHTML = html;
            }).catch(error => {
                console.error("Fetch error:", error);
                element.innerHTML = "<p>No album information available</p>";
            });
        }
    </script>
</body>
</html>

{% endblock %}