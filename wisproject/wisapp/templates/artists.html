{% extends 'base.html' %}
{% load static %}

{% block content %}

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Let's get shit done</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>

<body>
    <div id="artist1">
        <h2 class="artistname"> </h2>
        <p class="genre"> </p>
        <p class="followers"> </p>
        <div id="image1"> </div>
    </div>
    <div id="artist2"> 
        <h2 class="artistname"> </h2>
        <p class="genre"> </p>
        <p class="followers"> </p>
        <div id="image2"> </div>
    </div>
    <div id="artist3">
        <h2 class="artistname"> </h2>
        <p class="genre"> </p>
        <p class="followers"> </p>
        <div id="image3"> </div>
     </div>
    <div id="artist4"> 
        <h2 class="artistname"> </h2>
        <p class="genre"> </p>
        <p class="followers"> </p>
        <div id="image4"> </div>
    </div>
    <script>
        //Post
        // curl -X POST "https://accounts.spotify.com/api/token" -H "Content-Type: application/x-www-form-urlencoded" -d "grant_type=client_credentials&client_id=52c45b6398544dce8ff8d3b9eb41d71f&client_secret=82c3bc810f8145d4b9b3c892607d8526"
        // Invoke-RestMethod -Uri "https://accounts.spotify.com/api/token" -Method POST -Headers @{"Content-Type"="application/x-www-form-urlencoded"} -Body "grant_type=client_credentials&client_id=52c45b6398544dce8ff8d3b9eb41d71f&client_secret=82c3bc810f8145d4b9b3c892607d8526"
        //https://open.spotify.com/artist/4CiDIYMPPxX4ZOJ2R1ZL9e?si=YVlwIKdAQ5iSM6Y_-tpomw
        artist_urls = ["4CiDIYMPPxX4ZOJ2R1ZL9e", "17qPb5DXDDbJixc4cmwJiF", "5l1EOSszNDO4mCXhXIxmTL", "1RyvyyTE3xzB2ZywiAwp0i"]



        const url = "https://accounts.spotify.com/api/token";
        const headers = {
            "Content-Type": "application/x-www-form-urlencoded"
        };
        const body = "grant_type=client_credentials&client_id=52c45b6398544dce8ff8d3b9eb41d71f&client_secret=82c3bc810f8145d4b9b3c892607d8526";
        let auth_code = ""
        let data1={};
        fetch(url, {
            method: 'POST',
            headers: headers,
            body: body
        })
        .then(response => response.json())
        .then(data => {
            data1 = data;
            auth_code = data['access_token'];
            for (const i in artist_urls){
                get_artist_info(i, artist_urls[i])
            }
            
        })
        .catch(error => console.error('Error:', error));

        
        function get_artist_info(i, url){
            total_url = "https://api.spotify.com/v1/artists/" + url
            ind=String(i)
            img_id = "image" + ind
            artist_id = "artist" + ind
            console.log("ARTIST ID:" + artist_id)

            fetch(total_url, {
                method: "GET",
                headers: {
                    "Authorization": "Bearer " + auth_code
                    }
            }).then(response => {
                    if (!response.ok) {
                        throw new Error("Network response was not ok");
                    }
                    return response.json();
            }).then(data => {
                    
                    //keys = external_urls, followers, genres, href, id, images, name, popularity, type, uri   
                    console.log(data);
                    const artist_element = document.getElementById(artist_id);
                    artist_element.getElementsByClassName('artistname')[0].innerText = data['name'];
                    artist_element.getElementsByClassName('genre')[0].innerText = data['genres'];
                    artist_element.getElementsByClassName('followers')[0].innerText = data['followers']['total'];
                    document.getElementById(img_id).innerHTML = "<img src=" + data['images'][2]['url'] + ">"
                    
            }).catch(error => {
                    console.error("Fetch error:", error);
            });

            

        }
    </script>
</body>
</html>

{% endblock %}